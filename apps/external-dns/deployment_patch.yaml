apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
spec:
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: external-dns
  template:
    metadata:
      labels:
        app: external-dns
    spec:
      containers:
      - name: external-dns
        envFrom:
        - secretRef:
            name: pihole-password
        args:
        - --source=service
        - --source=ingress
        # Pihole only supports A/CNAME records so there is no mechanism to track ownership.
        # You don't need to set this flag, but if you leave it unset, you will receive warning
        # logs when ExternalDNS attempts to create TXT records.
        - --registry=noop
        # IMPORTANT: If you have records that you manage manually in Pi-hole, set
        # the policy to upsert-only so they do not get deleted.
        - --policy=upsert-only
        - --provider=pihole
        # Change this to the actual address of your Pi-hole web server
        - --pihole-server=http://192.168.16.53
      # - name: external-dns-cloudflare
      #   image: registry.k8s.io/external-dns/external-dns:v0.13.5
      #   args:
      #   - --source=service # ingress is also possible
      #   - --domain-filter=integratn.tech # (optional) limit to only example.com domains; change to match the zone created above.
      #   - --provider=cloudflare
      #   - --cloudflare-proxied # (optional) enable the proxy feature of Cloudflare (DDOS protection, CDN...)
      #   - --cloudflare-dns-records-per-page=5000 # (optional) configure how many DNS records to fetch per request
      #   envFrom:
      #   - secretRef:
      #       name: cloudflare-api-key
      #   - secretRef:
      #       name: cloudflare-email