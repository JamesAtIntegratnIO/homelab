namespace: argocd
resources:
- namespace.yaml
- github.com/argoproj/argo-cd/manifests/cluster-install/?ref=v2.7.8
- infra_project.yaml
- repositories.yaml

configMapGenerator:
  - name: argocd-cm
    behavior: merge
    literals:
    - kustomize.buildOptions=--enable-helm
    - configManagmentPlugins= |
        - name: kustomized-helm
          init:
            command: ["/bin/sh", "-c"]
            args: ["helm dependency build"]
          generate:
            command: [sh, -c]
            args: ["helm template $ARGOCD_APP_NAME --namespace $ARGOCD_APP_NAMESPACE --include-crds . > all.yaml && kustomize build"]
